(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{4870:e=>{e.exports={mapContainer:"Map_mapContainer__6p31l","leaflet-control-attribution":"Map_leaflet-control-attribution__jEgAi"}},6463:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var r=n(7876),o=n(4232);let l=(0,o.createContext)(null);function a(){let e=(0,o.use)(l);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var c=n(6895),i=n.n(c);let u=(0,o.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:a,id:i,placeholder:u,style:s,whenReady:f,zoom:p,...d},g){let[m]=(0,o.useState)({className:a,id:i,style:s}),[h,v]=(0,o.useState)(null),y=(0,o.useRef)(void 0);(0,o.useImperativeHandle)(g,()=>h?.map??null,[h]);let b=(0,o.useCallback)(r=>{if(null!==r&&!y.current){let o=new c.Map(r,d);y.current=o,null!=n&&null!=p?o.setView(n,p):null!=e&&o.fitBounds(e,t),null!=f&&o.whenReady(f),v(Object.freeze({__version:1,map:o}))}},[]);(0,o.useEffect)(()=>()=>{h?.map.remove()},[h]);let C=h?o.createElement(l,{value:h},r):u??null;return o.createElement("div",{...m,ref:b},C)});var s=n(8477);function f(e,t){let n=(0,o.useRef)(t);(0,o.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function p(e,t){let n=(0,o.useRef)(void 0);(0,o.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function d(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function g(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function m(e,t){return null==t?function(t,n){let r=(0,o.useRef)(void 0);return r.current||(r.current=e(t,n)),r}:function(n,r){let l=(0,o.useRef)(void 0);l.current||(l.current=e(n,r));let a=(0,o.useRef)(n),{instance:c}=l.current;return(0,o.useEffect)(function(){a.current!==n&&(t(c,n,a.current),a.current=n)},[c,n,t]),l}}function h(e){return function(t){var n;let r=a(),l=e(d(t,r),r);return f(r.map,t.attribution),p(l.current,t.eventHandlers),n=l.current,(0,o.useEffect)(function(){return(r.layerContainer??r.map).addLayer(n.instance),function(){r.layerContainer?.removeLayer(n.instance),r.map.removeLayer(n.instance)}},[r,n]),l}}let v=function(e,t){var n;return n=h(m(e,t)),(0,o.forwardRef)(function(e,t){let{instance:r}=n(e).current;return(0,o.useImperativeHandle)(t,()=>r),null})}(function({url:e,...t},n){return g(new c.TileLayer(e,d(t,n)),n)},function(e,t,n){let{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o);let{url:l}=t;null!=l&&l!==n.url&&e.setUrl(l)}),y=function(e,t){var n;return n=h(m(e,t)),(0,o.forwardRef)(function(e,t){let{instance:r,context:a}=n(e).current;(0,o.useImperativeHandle)(t,()=>r);let{children:c}=e;return null==c?null:o.createElement(l,{value:a},c)})}(function({position:e,...t},n){var r;let o=new c.Marker(e,t);return g(o,(r={overlayContainer:o},Object.freeze({...n,...r})))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),b=function(e,t){var n,r;return n=m(e),r=function(e,r){let o=a(),l=n(d(e,o),o);return f(o.map,e.attribution),p(l.current,e.eventHandlers),t(l.current,o,e,r),l},(0,o.forwardRef)(function(e,t){let[n,l]=(0,o.useState)(!1),{instance:a}=r(e,l).current;(0,o.useImperativeHandle)(t,()=>a),(0,o.useEffect)(function(){n&&a.update()},[a,n,e.children]);let c=a._contentNode;return c?(0,s.createPortal)(e.children,c):null})}(function(e,t){return g(new c.Tooltip(e,t.overlayContainer),t)},function(e,t,{position:n},r){(0,o.useEffect)(function(){let o=t.overlayContainer;if(null==o)return;let{instance:l}=e,a=e=>{e.tooltip===l&&(null!=n&&l.setLatLng(n),l.update(),r(!0))},c=e=>{e.tooltip===l&&r(!1)};return o.on({tooltipopen:a,tooltipclose:c}),o.bindTooltip(l),function(){o.off({tooltipopen:a,tooltipclose:c}),null!=o._map&&o.unbindTooltip()}},[e,t,r,n])});function C(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}n(1782);var w=function e(t,n){function r(e,r,o){if("undefined"!=typeof document){"number"==typeof(o=C({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var a in o)o[a]&&(l+="; "+a,!0!==o[a]&&(l+="="+o[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+l}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},o=0;o<n.length;o++){var l=n[o].split("="),a=l.slice(1).join("=");try{var c=decodeURIComponent(l[0]);if(r[c]=t.read(a,c),e===c)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",C({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,C({},this.attributes,t))},withConverter:function(t){return e(C({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),x=n(4870),I=n.n(x),O=n(9231),E=n(2734);let j=new(i()).Icon({iconUrl:"/marker.png",iconSize:[38,38],iconAnchor:[19,38],popupAnchor:[0,-38]}),_=new(i()).Icon({iconUrl:"/globe.svg",iconSize:[30,30],iconAnchor:[15,15]}),A=e=>{let t;return t=10===e?"1.png":20===e?"2.png":30===e?"3.png":40===e?"4.png":45===e?"5-.png":50===e?"5+.png":55===e?"6-.png":60===e?"6+.png":70===e?"7.png":"1.png",new(i()).Icon({iconUrl:"/magnitude/magnitude/".concat(t),iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]})},R=e=>{let{position:t,eewPosition:n}=e,r=a().map;return(0,o.useEffect)(()=>{n?r.setView(n,8):t&&r.setView(t,10)},[t,n,r]),null},N=e=>{let{earthquake:t,eewData:n,points:l=[]}=e,{theme:a}=(0,o.useContext)(O.D),{setIsLoading:c}=(0,E.M)(),[i,s]=(0,o.useState)([]),f=t.latitude&&t.longitude?[t.latitude,t.longitude]:null,p=n&&n.latitude&&n.longitude?[n.latitude,n.longitude]:null,d=JSON.stringify(l);return(0,o.useEffect)(()=>{let e=!0,t=(e,t)=>{let n=e;if(n.startsWith(t))n=n.substring(t.length).trim();else if(t.endsWith("県")||t.endsWith("都")||t.endsWith("道")||t.endsWith("府")){let e=t.substring(0,t.length-1);n.startsWith(e)&&(n=n.substring(e.length).trim())}return n},n=async(e,n)=>new Promise(r=>setTimeout(async()=>{let n=t(e.addr,e.pref),o="geocode_".concat(n),l=w.get(o);if(l)try{let t=JSON.parse(l);console.log("Using cached geocode for ".concat(e.addr," (cleaned to ").concat(n,")")),r({addr:e.addr,lat:t.lat,lng:t.lng,pref:e.pref,scale:e.scale});return}catch(t){console.error("Error parsing cached data for ".concat(e.addr,":"),t),w.remove(o)}try{let t="f0e6887039e2449c869ccb2d425830a9";if(!t){console.error("OpenCage API key is not defined. Please set NEXT_PUBLIC_OPENCAGE_API_KEY in your .env.local file."),r(null);return}let l=encodeURIComponent(n),a=await fetch("https://api.opencagedata.com/geocode/v1/json?q=".concat(l,"&key=").concat(t,"&language=ja&countrycode=jp&limit=1"));if(!a.ok){console.error("OpenCage API error for ".concat(e.addr," (cleaned to ").concat(n,"): ").concat(a.statusText)),r(null);return}let c=await a.json();if(console.log("OpenCage API response for ".concat(e.addr," (cleaned to ").concat(n,"):"),c),c&&c.results&&c.results.length>0){let t=parseFloat(c.results[0].geometry.lat),l=parseFloat(c.results[0].geometry.lng);if(isNaN(t)||isNaN(l))console.error("OpenCage API returned invalid coordinates for ".concat(e.addr," (cleaned to ").concat(n,"): lat=").concat(c.results[0].geometry.lat,", lng=").concat(c.results[0].geometry.lng),c),r(null);else{let n={addr:e.addr,lat:t,lng:l,pref:e.pref,scale:e.scale};w.set(o,JSON.stringify({lat:t,lng:l}),{expires:7}),r(n)}}else console.error("OpenCage API did not return results for ".concat(e.addr," (cleaned to ").concat(n,")"),c),r(null)}catch(t){console.error("Error fetching geocode for ".concat(e.addr," (cleaned to ").concat(n,"):"),t),r(null)}},n));return async function(){let t=JSON.parse(d);if(!t||0===t.length){s([]),c(!1);return}c(!0);let r=t.map((e,t)=>n(e,1100*t)),o=(await Promise.all(r)).filter(e=>null!==e);e&&s(e=>JSON.stringify(e)!==JSON.stringify(o)?o:e),c(!1)}(),()=>{e=!1}},[d,c]),(0,r.jsxs)(u,{center:[35.6895,139.6917],zoom:5,className:I().mapContainer,children:[(0,r.jsx)(v,{url:"light"===a?"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png":"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:"light"===a?'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors':'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}),(0,r.jsx)(R,{position:f,eewPosition:p}),f&&(0,r.jsx)(y,{position:f,icon:j}),i.map((e,t)=>(0,r.jsx)(y,{position:[e.lat,e.lng],icon:A(e.scale),children:(0,r.jsx)(b,{direction:"top",offset:[0,-30],opacity:1,permanent:!1,children:(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:e.addr}),(0,r.jsx)("br",{}),e.pref," / scale: ",e.scale]})})},t)),p&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(y,{position:p,icon:_})})]})}}}]);