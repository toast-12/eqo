"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[365],{7365:(e,t,o)=>{o.r(t),o.d(t,{WebSocketProvider:()=>l,useWebSocket:()=>a});var r=o(7876),n=o(4232);let c=(0,n.createContext)(null),a=()=>(0,n.useContext)(c),l=e=>{let{children:t}=e,[o,a]=(0,n.useState)([]),[l,u]=(0,n.useState)(null),s=(0,n.useRef)(null),i=(0,n.useRef)(null),d=(0,n.useRef)(!1),m=()=>{s.current&&s.current.close(),s.current=new WebSocket("wss://api.p2pquake.net/v2/ws"),s.current.onopen=()=>{console.log("WebSocket connected"),i.current&&(clearTimeout(i.current),i.current=null)},s.current.onmessage=e=>{try{let t=JSON.parse(e.data);551===t.code?(console.log("Received Earthquake Data (code 551). Checking for points field:",t.points),a(e=>{let o=new Date;o.setDate(o.getDate()-2),o.setHours(0,0,0,0);let r=e.filter(e=>new Date(e.time)>=o),n=[t,...r],c=n.find(e=>551===e.code),a=localStorage.getItem("lastPlayedSoundTime");return c&&c.time!==a&&(console.log("Playing notification sound for new earthquake:",c.time),localStorage.setItem("lastPlayedSoundTime",c.time)),n})):556===t.code&&(u(t),console.log("Received EEW Data:",t))}catch(e){console.error("Error parsing WebSocket message:",e)}},s.current.onerror=e=>{console.error("WebSocket error:",e)},s.current.onclose=e=>{console.log("WebSocket disconnected:",e.code,e.reason),e.wasClean||1e3===e.code||(console.log("Attempting to reconnect WebSocket..."),i.current=setTimeout(m,3e3))}};return(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("https://api.p2pquake.net/v2/history?limit=100"),t=await e.json();if(t&&t.length>0){let e=new Date;e.setDate(e.getDate()-15),e.setHours(0,0,0,0);let o=t.filter(t=>{let o=new Date(t.time);return 551===t.code&&o>=e});a(o.slice(0,15))}}catch(e){console.error("Error fetching historical data:",e)}};return d.current||(m(),e(),d.current=!0),()=>{s.current&&s.current.close(1e3,"Component unmounted"),i.current&&clearTimeout(i.current)}},[]),(0,n.useEffect)(()=>(window.downloadEarthquakeData=()=>{if(o){let e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="earthquake_data.json",setTimeout(()=>{document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},0)}},()=>{window.downloadEarthquakeData=null}),[o]),(0,r.jsx)(c.Provider,{value:{earthquakeData:o,eewData:l,simulateEarthquake:e=>{a(t=>[e,...t])},simulateEEW:e=>{u(e)}},children:t})}}}]);